<template>
  <div class="fon">
    <div class="form-container">
      <div class="logo">
        <svg
          width="77"
          height="63"
          viewBox="0 0 77 63"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink"
        >
          <rect width="77" height="63" fill="url(#pattern0_206_876)" />
          <defs>
            <pattern
              id="pattern0_206_876"
              patternContentUnits="objectBoundingBox"
              width="1"
              height="1"
            >
              <use
                xlink:href="#image0_206_876"
                transform="matrix(0.00138206 0 0 0.00168919 -0.00790848 0)"
              />
            </pattern>
            <image
              id="image0_206_876"
              width="735"
              height="592"
              xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAt8AAAJQCAYAAABW7AjJAAAACXBIWXMAABYlAAAWJQFJUiTwAAAMfklEQVR4nO3awW2aQRhF0SH6C0gHAYkC0oGdJVXEndiuiqUpwQUgQQnpgChSpMQ7ezFXIJ8j0cD7ENzFrE677f2AOc6b/fFsWwBuyeVyWY8x1o7GBL+WMcaLZZnkeYzxZFwAbszDGOPR0Zjg8MWqAADQEN8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEFkMDQDwxsEcTHIW3wAA/1mtVgcBziyenQAAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBAZDE0AMA/p932YYzx0yRM8Cq+AQDeWo8x7m3CDJ6dAABARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBkMTRwDU677XqM8eAYzLDZH58MC1wD8Q1ciz/x/egaTCK+gavg2QkAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARBZDM9Hdabd9MjDv9O0DQ53/fvjcvo8xvr5nAb9FfNCdwZhlddptL9YFbszzZn8UU5/cabd9GWPcf/YdgJtyWDb748rNmMEfIwA36rDZH384HjN48w0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AAJHF0Ez0alwmORsWvzFM5LvFHGOM37WGNQFKXUT1AAAAAElFTkSuQmCC"
            />
          </defs>
        </svg>
      </div>
      <form @submit.prevent="handleSubmit">
        <div class="form-group">
          <div>
            <label for="firstName">First name</label>
            <input id="firstName" v-model="firstName" type="text" required />
          </div>
          <div>
            <label for="lastName">Last name</label>
            <input id="lastName" v-model="lastName" type="text" required />
          </div>
        </div>
        <div class="form-group">
          <div>
            <label for="email">E-mail</label>
            <input id="email" v-model="email" type="email" required />
          </div>
          <div>
            <label for="phone">Phone</label>
            <input id="phone" v-model="phone" type="tel" required />
          </div>
        </div>
        <div class="form-group">
          <div class="password-container">
            <label for="password">Password</label>
            <input
              :type="showPassword ? 'text' : 'password'"
              v-model="password"
              id="password"
              required
            />
            <svg
              @click="togglePasswordVisibility"
              width="30"
              height="23"
              viewBox="0 0 30 23"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M1.37527 12.5698C1.18159 12.2463 1.08475 12.0846 1.03054 11.8351C0.98982 11.6477 0.98982 11.3523 1.03054 11.1649C1.08475 10.9154 1.18159 10.7537 1.37527 10.4302C2.97578 7.75726 7.73985 1 15 1C22.2602 1 27.0242 7.75726 28.6247 10.4302C28.8184 10.7537 28.9153 10.9154 28.9695 11.1649C29.0102 11.3523 29.0102 11.6477 28.9695 11.8351C28.9153 12.0846 28.8184 12.2463 28.6247 12.5698C27.0242 15.2427 22.2602 22 15 22C7.73985 22 2.97578 15.2427 1.37527 12.5698Z"
                stroke="#3E3D3E"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M15 16C17.3563 16 19.2665 13.9853 19.2665 11.5C19.2665 9.01472 17.3563 7 15 7C12.6437 7 10.7335 9.01472 10.7335 11.5C10.7335 13.9853 12.6437 16 15 16Z"
                stroke="#3E3D3E"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </div>
          <div class="password-container">
            <label for="confirmPassword">Confirm password</label>
            <input
              :type="showConfirmPassword ? 'text' : 'password'"
              v-model="password2"
              id="confirmPassword"
              required
            />
            <svg
              @click="toggleConfirmPasswordVisibility"
              width="30"
              height="23"
              viewBox="0 0 30 23"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M1.37527 12.5698C1.18159 12.2463 1.08475 12.0846 1.03054 11.8351C0.98982 11.6477 0.98982 11.3523 1.03054 11.1649C1.08475 10.9154 1.18159 10.7537 1.37527 10.4302C2.97578 7.75726 7.73985 1 15 1C22.2602 1 27.0242 7.75726 28.6247 10.4302C28.8184 10.7537 28.9153 10.9154 28.9695 11.1649C29.0102 11.3523 29.0102 11.6477 28.9695 11.8351C28.9153 12.0846 28.8184 12.2463 28.6247 12.5698C27.0242 15.2427 22.2602 22 15 22C7.73985 22 2.97578 15.2427 1.37527 12.5698Z"
                stroke="#3E3D3E"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M15 16C17.3563 16 19.2665 13.9853 19.2665 11.5C19.2665 9.01472 17.3563 7 15 7C12.6437 7 10.7335 9.01472 10.7335 11.5C10.7335 13.9853 12.6437 16 15 16Z"
                stroke="#3E3D3E"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </div>
        </div>
        <div class="form-group">
          <div>
            <label for="company">Company</label>
            <input id="company" v-model="company" type="text" />
          </div>
          <div>
            <label for="usdot">Usdot</label>
            <input id="usdot" v-model="usdot" type="text" />
          </div>
        </div>
        <div class="form-group">
          <div>
            <label for="numberEmployees">Number employees</label>
            <input
              id="numberEmployees"
              v-model="numberEmployees"
              type="number"
            />
          </div>
        </div>
        <div class="form-group checkbox-group">
          <input type="checkbox" id="terms" v-model="termsAccepted" />
          <label class="check" for="terms">
            By checking this box, you acknowledge that you have read,
            understand, and agree to our <span>Terms and Privacy Policy</span>
          </label>
        </div>
        <div class="btn__sing">
          <button type="submit">Sign up</button>
        </div>
      </form>

      <p>
        Already registered?
        <router-link to="/singIn">
          <span>Sign in</span>
        </router-link>
      </p>
    </div>
  </div>
</template>
<script setup>
import { ref } from "vue";
import { useRouter } from "vue-router"; 
const firstName = ref("");
const lastName = ref("");
const email = ref("");
const phone = ref("");
const password = ref("");
const password2 = ref("");
const company = ref("");
const usdot = ref("");
const numberEmployees = ref(null);
const termsAccepted = ref(false);
const showPassword = ref(false);
const showConfirmPassword = ref(false);
const router = useRouter(); 

const handleSubmit = async () => {
  try {
    const payload = {
      email: email.value,
      password: password.value,
      password2: password2.value,
      phone: phone.value,
      company: company.value,
      usdot: usdot.value,
      first_name: firstName.value,
      last_name: lastName.value,
    };

    // Отправка запроса на сервер
    const response = await fetch('http://34.40.8.20/api/v1/account/register/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(payload),
    });

    if (!response.ok) {
      const errorResponse = await response.text(); // Чтение ответа как текст

      // Если сервер вернул HTML вместо JSON
      if (errorResponse.startsWith("<!DOCTYPE html>")) {
        router.push("/singIn"); // Перенаправление на страницу входа
      } else {
        // Если ошибка связана с существующим email
        try {
          const errorJson = JSON.parse(errorResponse);
          if (errorJson.email && errorJson.email.includes("user with this email already exists.")) {
            alert("Пользователь с таким email уже существует.");
          } else {
            console.log(JSON.stringify(payload));
            alert("Ошибка регистрации1: " + JSON.stringify(errorJson));
            
          }
        } catch (e) {
          console.error("Не удалось разобрать ответ сервера:", errorResponse);
        }
      }

      throw new Error('Network response was not ok');
    }

    const result = await response.json();
    if (result.success || result.message === undefined) {
      router.push('/singIn');
      alert('Регистрация успешна');
    } else {

      alert('Ошибка регистрации2: ' + result.message);
    }
  } catch (error) {
    console.error('Error:', error);
  }
};

const handleErrors = (errorData) => {
  for (const [field, errors] of Object.entries(errorData)) {
    console.error(`${field}: ${errors.join(', ')}`);
  }
};

function togglePasswordVisibility() {
  showPassword.value = !showPassword.value;
}

function toggleConfirmPasswordVisibility() {
  showConfirmPassword.value = !showConfirmPassword.value;
}
</script>

<style scoped>
.check {
  font-size: 20px;
}
.btn__sing {
  width: 100%;
  display: flex;
  justify-content: center;
}
.logo {
  justify-content: center;
  display: flex;
  padding-bottom: 60px;
}
label span:hover {
  text-decoration: underline;
  cursor: pointer;
}
label {
  font-size: 24px;
  font-weight: 400;
  color: #6d6d6d;
  font-family: Inter;
}
.form-container {
  max-width: 1000px;
  margin: 0 auto;
  padding: 40px;
  background-color: #171416;
  color: #fff;
  border-radius: 10px;
}

.form-group {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-bottom: 20px;
}

.form-group > div {
  display: flex;
  flex-direction: column;
}
.checkbox-group {
  all: unset;
}
.password-container {
  display: flex;
  flex-direction: column;
  position: relative;
}

.password-container svg {
  position: absolute;
  right: 13%;
  top: 75%;
  transform: translateY(-50%);
  color: #fff;
  cursor: pointer;
}
input[type="checkbox"] {
  border: 1px solid #3e3d3e;
  width: 20px;
  height: 20px;
  align-items: center;
  text-align: center;
}

input[type="text"],
input[type="email"],
input[type="tel"],
input[type="password"],
input[type="number"] {
  max-width: 400px;
  padding: 20px;
  border-radius: 5px;
  border: 2px solid #3e3d3e;
  background-color: #171416;
  color: #fff;
}

button[type="submit"] {
  width: 440px;
  padding: 20px;
  border: none;
  margin-top: 70px;
  border-radius: 5px;
  background-color: #df4924;
  color: #fff;
  font-size: 18px;
  cursor: pointer;
}

button[type="submit"]:hover {
  background-color: #e44;
}

p {
  font-family: Inter;
  text-align: center;
  margin-top: 20px;
  font-size: 20px;
  color: #6d6d6d;
}

p span {
  color: #e9ecef;
  text-decoration: none;
  cursor: pointer;
}

p span:hover {
  text-decoration: underline;
}

/* Адаптивность */

@media (max-width: 1024px) {
  .password-container svg {
    right: 8%;
  }
  @media (max-width: 768px) {
    .form-group {
      grid-template-columns: 1fr;
    }
    .password-container svg {
      right: 38%;
    }
    button[type="submit"] {
      margin-top: 10px;
    }
    @media (max-width: 576px) {
      .password-container svg {
        right: 0%;
      }
    }
    @media (max-width: 425px) {
      .password-container svg {
        right: 5%;
      }
    }
  }
}
</style>
  