<template>
  <div class="fon">
    <div class="login-container">
      <div class="logo">
        <svg
          width="77"
          height="63"
          viewBox="0 0 77 63"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink"
        >
          <rect width="77" height="63" fill="url(#pattern0_206_876)" />
          <defs>
            <pattern
              id="pattern0_206_876"
              patternContentUnits="objectBoundingBox"
              width="1"
              height="1"
            >
              <use
                xlink:href="#image0_206_876"
                transform="matrix(0.00138206 0 0 0.00168919 -0.00790848 0)"
              />
            </pattern>
            <image
              id="image0_206_876"
              width="735"
              height="592"
              xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAt8AAAJQCAYAAABW7AjJAAAACXBIWXMAABYlAAAWJQFJUiTwAAAMfklEQVR4nO3awW2aQRhF0SH6C0gHAYkC0oGdJVXEndiuiqUpwQUgQQnpgChSpMQ7ezFXIJ8j0cD7ENzFrE677f2AOc6b/fFsWwBuyeVyWY8x1o7GBL+WMcaLZZnkeYzxZFwAbszDGOPR0Zjg8MWqAADQEN8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEBHfAAAQEd8AABAR3wAAEFkMDQDwxsEcTHIW3wAA/1mtVgcBziyenQAAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBAZDE0AMA/p932YYzx0yRM8Cq+AQDeWo8x7m3CDJ6dAABARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBEfAMAQER8AwBARHwDAEBkMTRwDU677XqM8eAYzLDZH58MC1wD8Q1ciz/x/egaTCK+gavg2QkAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARMQ3AABExDcAAETENwAARBZDM9Hdabd9MjDv9O0DQ53/fvjcvo8xvr5nAb9FfNCdwZhlddptL9YFbszzZn8UU5/cabd9GWPcf/YdgJtyWDb748rNmMEfIwA36rDZH384HjN48w0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AABHxDQAAEfENAAAR8Q0AAJHF0Ez0alwmORsWvzFM5LvFHGOM37WGNQFKXUT1AAAAAElFTkSuQmCC"
            />
          </defs>
        </svg>
      </div>
      <div class="input__log__in">
        <div class="form-group">
          <label for="email">E-mail</label>
          <input type="email" id="email" v-model="email" required />
        </div>
      </div>
      <div class="input__log">
        <div class="form-group password-group">
          <label for="password">Password</label>
          <input
            :type="showPassword ? 'text' : 'password'"
            id="password"
            v-model="password"
            class="password-input"
            required
          />
          <span class="toggle-password" @click="togglePasswordVisibility">
            <svg
              width="30"
              height="23"
              viewBox="0 0 30 23"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M1.37527 12.5698C1.18159 12.2463 1.08475 12.0846 1.03054 11.8351C0.98982 11.6477 0.98982 11.3523 1.03054 11.1649C1.08475 10.9154 1.18159 10.7537 1.37527 10.4302C2.97578 7.75726 7.73985 1 15 1C22.2602 1 27.0242 7.75726 28.6247 10.4302C28.8184 10.7537 28.9153 10.9154 28.9695 11.1649C29.0102 11.3523 29.0102 11.6477 28.9695 11.8351C28.9153 12.0846 28.8184 12.2463 28.6247 12.5698C27.0242 15.2427 22.2602 22 15 22C7.73985 22 2.97578 15.2427 1.37527 12.5698Z"
                stroke="#3E3D3E"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M15 16C17.3563 16 19.2665 13.9853 19.2665 11.5C19.2665 9.01472 17.3563 7 15 7C12.6437 7 10.7335 9.01472 10.7335 11.5C10.7335 13.9853 12.6437 16 15 16Z"
                stroke="#3E3D3E"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </span>
        </div>
      </div>

      <div class="btn_log__in">
        <button @click="loginUser" type="submit" class="login-button">
          Sign in
        </button>
      </div>
      <div class="additional-options">
        <span class="forgot-password">Forget password?</span>
        <span class="create-account"
          >Don’t have an account?    <router-link to="/singUp">
            <span class="log">Create one</span>
          </router-link></span
        >
      </div>
    </div>
  </div>
</template>
  
<script setup>
import { ref } from "vue";
import { useRouter } from "vue-router";
import { useStore } from "vuex";

const emit = defineEmits();
const store = useStore();

const email = ref("");
const password = ref("");
const showPassword = ref(false);

const router = useRouter();

function loginUser() {
  if (!email.value || !password.value) {
    alert("Please fill in both fields.");
    return;
  }

  const loginData = {
    email: email.value,
    password: password.value,
  };

  fetch("http://34.141.16.56/api/v1/account/login/", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(loginData),
  })
    .then((response) => {
      if (!response.ok) {
        throw new Error("Network response was not ok");
      }
      return response.json();
    })
    .then((data) => {
      localStorage.setItem("refreshToken", data.refresh);
      localStorage.setItem("accessToken", data.access);

      
      const accessToken = localStorage.getItem("accessToken");

      fetch("http://34.141.16.56/api/v1/account/userinfo/", {
        method: "GET",
        headers: {
          Authorization: `Bearer ${accessToken}`,
          "Content-Type": "application/json",
        },
      })
        .then((response) => response.json())
        .then((data) => store.commit("logDataAdd", data))
        .catch((error) => console.error("Error:", error));



      if (data.access) {
        router.push("/dashboard");
      } else {
        alert("Authentication failed.");
      }
    })
    .catch((error) => {
      console.error("Error:", error);
      alert("Failed to log in.");
    });
}

const togglePasswordVisibility = () => {
  showPassword.value = !showPassword.value;
};
</script>
  
<style scoped>
.qwe{
  all: unset;
}
.log {
  color: #e9ecef;
  cursor: pointer;
  font-weight: 400;
}
span {
  font-family: Inter;
  font-style: 24px;
}
.input__log {
  display: flex;
  justify-content: center;
}
.input__log__in {
  display: flex;
  justify-content: center;
}
.btn_log__in {
  display: flex;
  justify-content: center;
}
:root {
  --input-bg-color: #333;
  --input-text-color: #fff;
  --input-border-color: #444;
}

.login-container {
  flex-direction: column;
  justify-content: center;
  max-width: 550px;
  margin: 0 auto;
  padding: 30px;
  background-color: #1c1c1c;
  border-radius: 15px;
  color: #fff;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
}

.logo {
  text-align: center;
  margin-bottom: 20px;
}

.form-group {
  margin-bottom: 20px;
  text-align: left;
}

.form-group label {
  display: block;
  margin-bottom: 5px;
  color: #6d6d6d;
  font-family: Inter;
  font-size: 24px;
  font-weight: 400;
}

.password-group {
  position: relative;
}

.toggle-password {
  position: absolute;
  right: 10px;
  top: 75px;
  cursor: pointer;
  color: #bbb;
}

input[type="email"],
input[type="text"],
input[type="password"] {
  max-width: 400px;
  min-width: 320px;
  padding: 20px;
  border-radius: 10px;
  border: 2px solid #3e3d3e;
  background-color: var(--input-bg-color);
  color: var(--input-text-color);
}

.login-button {
  width: 40%;
  padding: 15px;
  background-color: #ff4500;
  border: none;
  font-family: Inter;
  border-radius: 5px;
  color: #e7e7e7;
  font-size: 16px;
  cursor: pointer;
  transition: background-color 0.3s;
}

.login-button:hover {
  background-color: #ff7f50;
}

.additional-options {
  text-align: center;
  margin-top: 15px;
}
.forgot-password {
  cursor: pointer;
}
.forgot-password,
.create-account {
  color: #6d6d6d;
  text-decoration: none;
}

.create-account {
  display: block;
  margin-top: 5px;
}

@media (max-width: 768px) {
  .login-container {
    padding: 20px;
  }

  .login-button {
    padding: 10px;
  }
}
</style>
  